<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Micro Focus Content Manager SDK 10.0: Zero Footprint Office Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygenBase.css" rel="stylesheet" type="text/css" />
<link href="doxyStylesheet.css" rel="stylesheet" type="text/css"/>
<link href="doxySidebarFixes.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mf_logo_white_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Micro Focus Content Manager SDK 10.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('zero_office.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Zero Footprint Office Integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md64">Components</a></li>
<li class="level1"><a href="#autotoc_md65">Requirements</a></li>
<li class="level1"><a href="#autotoc_md66">ServiceAPI</a><ul><li class="level2"><a href="#autotoc_md67">ServiceAPI Configuration</a><ul><ul><li class="level4"><a href="#autotoc_md68">Office Integration configuration</a></li>
</ul>
</ul>
</li>
<li class="level2"><a href="#autotoc_md69">ServiceAPI Authentication Permissions</a></li>
<li class="level2"><a href="#autotoc_md70">ServiceAPI Authentication Application ID</a></li>
</ul>
</li>
<li class="level1"><a href="#zero_manifests">Manifests</a></li>
<li class="level1"><a href="#autotoc_md71">Email Link</a></li>
<li class="level1"><a href="#autotoc_md72">OneDrive file handler</a><ul><li class="level2"><a href="#refresh_access_token">Refreshing the file handler</a></li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_15___Office_Integration"></a></p>
<h1><a class="anchor" id="autotoc_md64"></a>
Components</h1>
<p>The zero footprint office is made up of a number of components, not all of which need to be configured depending on the level of functionality required. The components are:</p><ul>
<li>ServiceAPI</li>
<li>Office 365 Application manifests</li>
<li>Email Link</li>
<li>OneDrive file handler</li>
</ul>
<h1><a class="anchor" id="autotoc_md65"></a>
Requirements</h1>
<p>The components listed above work together to provide the complete zero footprint integration. If the only part of the integration required is the Outlook integration then only the ServiceAPI, Email Link and Outlook manifest are required, the other components (Office manifest, Email Link and OneDrive handler) are required for Word, Excel and PowerPoint.</p>
<h1><a class="anchor" id="autotoc_md66"></a>
ServiceAPI</h1>
<p>The ServiceAPI must be installed and must have a valid HTTPS certificate, any HTTP errors will cause the Office Integration to fail.</p>
<p>The ServiceAPI performs three functions within the integration:</p><ul>
<li>hosts the web application that is embedded in Office as the add-in (at /CMServiceAPI/office/index.html),</li>
<li>provides the backend services to which the add-on communicates when reading from or writing to Content Manager, and</li>
<li>provides services that act as a proxy between the Add-in and OneDrive for reading from and writing to OneDrive.</li>
</ul>
<h2><a class="anchor" id="autotoc_md67"></a>
ServiceAPI Configuration</h2>
<h4><a class="anchor" id="autotoc_md68"></a>
Office Integration configuration</h4>
<p>The ServiceAPI must be provided with the GUID and Version found in the Id element of the Office add-in <a href="#zero_manifests">manifest</a>. This guid is used when a document is first opened from Content Manager to notify the add-in that the Content Manager add-in should be auto-opened when the document is opened. To add this GUID:</p><ul>
<li>edit the hptrim.config file</li>
<li>add the officeIntegration element below the setup element</li>
</ul>
<p>** Example **</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">officeIntegration</span> <span class="keyword">guid</span>=<span class="stringliteral">&quot;5d7bd8ba-11b0-46b1-98ab-95fadd95a97d&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0.0.0&quot;</span>/&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md69"></a>
ServiceAPI Authentication Permissions</h2>
<p>The ServiceAPI must be configured to use OpenId Connect authentication as described in the <a href="oidc.html#oidc_azuread">authentication section</a>. New permissions must be assigned to the Azure AD Application to support OneDrive access, these are:</p><ul>
<li>Delegated:<ul>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
</ul>
</li>
<li>Application:<ul>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
<li>Office 365 Exchange Online - full_access_as_app</li>
</ul>
</li>
</ul>
<p>To assign these permissions:</p><ul>
<li>open the Azure AD Application used for authenticating the Web Client</li>
<li>go to API permissions</li>
<li>select 'Add a permission'</li>
<li>select Microsoft Graph</li>
<li>choose either 'Delegated' or 'Application' permissions</li>
<li>find the permission and add it <br  />
</li>
<li>once you have added all the permissions select 'Grant admin consent' to consent to all permissions.</li>
</ul>
<p>** Note ** The Office 365 Exchange Online permission is not a part of the OneDrive permissions, to find it:</p><ul>
<li>select 'Add a permission' <br  />
</li>
<li>select 'API's my organisation uses'</li>
<li>find 'Office 365 Exchange Online' in the listed</li>
<li>add the 'Application' permission as you did the other permissions.</li>
</ul>
<h2><a class="anchor" id="autotoc_md70"></a>
ServiceAPI Authentication Application ID</h2>
<p>The office integration requires that the Application ID Uri in the Azure AD App include the domain name of your ServiceAPI server, this must be adjusted before installing the office integration manifests. To adjust the Application ID URI:</p><ol type="1">
<li>open the Azure App referenced from your ServiceAPI hptrim.config file,</li>
<li>go the 'Expose an API' page,</li>
<li>edit the Application ID URI field,</li>
<li>by default the Application ID URI will look something like this <code>api://2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>,</li>
<li>edit the Application ID URI to include the name of your ServiceAPI server, for example <code>api://myserver.com/2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>, then</li>
<li>Once you have modified this you will need to update the appIdURI property in the ServiceAPI hptrim.config file.</li>
</ol>
<h1><a class="anchor" id="zero_manifests"></a>
Manifests</h1>
<p>The manifest's purpose is to notify Office 365 of the presence of your add-in. Manifest files must be customised before upload to your Office 365 Admin. To prepare your manifests:</p><ul>
<li>download the <a href="files/manifests.zip">sample manifests</a>,</li>
<li><a href="https://www.guidgenerator.com/online-guid-generator.aspx">generate</a> a new Guid for each manifest (if you are installing both Outlook and Office integrations),</li>
<li>replace the Id in each manifest with a valid Guid,</li>
<li>set the GUID from the Office manifest in the officeIntegration element in the hptrim.config file (see above),</li>
<li>assuming the ServiceAPI is in the pattern <a href="https://yourserver.com/CMServiceAPI">https://yourserver.com/CMServiceAPI</a> do a search and replace of each manifest, replacing [MYSERVER] with your server name,</li>
<li>at the bottom of the manifest is an element called 'WebApplicationInfo', replace the 'Id' value with the Application Id from Azure and the 'Resource' value with the Application ID URI from Azure,</li>
<li>the name of the add-in that will be displayed in the task pane title (and in the context menu for Outlook) is embedded in the manifest, by default it is 'Content Manager' but this can be changed if desired, and</li>
<li>go to the <a href="https://admin.microsoft.com/?applauncher#/Settings/AddIns">Add-ins page</a> in Office 365 Admin and deploy each manifest.</li>
</ul>
<h1><a class="anchor" id="autotoc_md71"></a>
Email Link</h1>
<p>Email Link serves to purposes in the Outlook/Office integration, to:</p><ol type="1">
<li>file email from Linked Folders in the Outlook integration, and</li>
<li>check documents in from Office applications when 'check in on close' is selected.</li>
</ol>
<p>Email Link should be installed as usual, there must be a Microsoft authentication configuration for your Office 365 domain that is of type OAuth and has both Email and Drive selected (if both Office and Outlook integration is required).</p>
<h1><a class="anchor" id="autotoc_md72"></a>
OneDrive file handler</h1>
<p>When a document is checked in to Content Managed via 'Check in and Delete on Close' a TR5 file is created as a stub for the document in OneDrive. The OneDrive file handler supports:</p><ul>
<li>re-opening the document for editing in OneDrive, and</li>
<li>previewing the document in-situ in Content Manager.</li>
</ul>
<p>To install the handler:</p><ul>
<li>download the <a href="files/handler.json">handler content</a>,</li>
<li>replace all instances of <code><a href="https://mfcm.xyz/ServiceAPI">https://mfcm.xyz/ServiceAPI</a></code> with the URL to your ServiceAPI instance, and</li>
<li>follow the <a href="https://docs.microsoft.com/en-us/onedrive/developer/file-handlers/register-manually?view=odsp-graph-online">instructions</a> for installing OneDrive handlers.</li>
</ul>
<h2><a class="anchor" id="refresh_access_token"></a>
Refreshing the file handler</h2>
<p>The file handler registration process can be somewhat fragile. In particular the time taken to reflect any changes is unpredictable. The instructions above refer to a service to <a href="https://docs.microsoft.com/en-us/onedrive/developer/file-handlers/reset-cache?view=odsp-graph-online">refresh the handler</a> which itself does not always seem to actually refresh the handler.</p>
<p>When refreshing the access token you will need to get a bearer authentication token first, some things to remember:</p><ul>
<li>Auth Url, Access Token URL, Client ID and Client Secret are sourced from your Azure AD app</li>
<li>Callback URL should be <code><a href="https://app.getpostman.com/oauth2/callback">https://app.getpostman.com/oauth2/callback</a></code> and must be set in the Redirect Uris of your Azure AD App</li>
<li>the scope will look something like this: <code><a href="https://mftrim-my.sharepoint.com/MyFiles.Write">https://mftrim-my.sharepoint.com/MyFiles.Write</a></code>, 'mftrim' should be replaced with your domain </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
