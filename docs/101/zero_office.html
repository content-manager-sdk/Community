<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Micro Focus Content Manager SDK 10.1: Zero Footprint Office Integration</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygenBase.css" rel="stylesheet" type="text/css" />
<link href="doxyStylesheet.css" rel="stylesheet" type="text/css"/>
<link href="doxySidebarFixes.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="mf_logo_white_small.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Micro Focus Content Manager SDK 10.1
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('zero_office.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Zero Footprint Office Integration </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md70">Components</a></li>
<li class="level1"><a href="#autotoc_md71">Requirements</a></li>
<li class="level1"><a href="#autotoc_md72">ServiceAPI</a><ul><li class="level2"><a href="#autotoc_md73">ServiceAPI Configuration</a><ul><ul><li class="level4"><a href="#autotoc_md74">Office Integration configuration</a></li>
</ul>
</ul>
</li>
<li class="level2"><a href="#autotoc_md75">ServiceAPI Authentication Permissions</a></li>
<li class="level2"><a href="#autotoc_md76">ServiceAPI Authentication Application ID</a></li>
<li class="level2"><a href="#autotoc_md77">ServiceAPI Authorized Client Applications</a></li>
</ul>
</li>
<li class="level1"><a href="#zero_manifests">Manifests</a></li>
<li class="level1"><a href="#autotoc_md78">Browser Cookies</a></li>
<li class="level1"><a href="#autotoc_md79">Email Link</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_doc_15___Office_Integration"></a></p>
<h1><a class="anchor" id="autotoc_md70"></a>
Components</h1>
<p>The zero footprint office integration is made up of a number of components, not all of which need to be configured depending on the level of functionality required. The components are:</p><ul>
<li>ServiceAPI</li>
<li>Office 365 Application manifests</li>
<li>Email Link</li>
</ul>
<h1><a class="anchor" id="autotoc_md71"></a>
Requirements</h1>
<p>The components listed above work together to provide the complete zero footprint integration. If the only part of the integration required is the Outlook integration then only the ServiceAPI, Email Link and Outlook manifest are required, the other components (Office manifest, and Email Link) are required for Word, Excel and PowerPoint.</p>
<h1><a class="anchor" id="autotoc_md72"></a>
ServiceAPI</h1>
<p>The ServiceAPI must be installed and must have a valid HTTPS certificate, any HTTP errors will cause the Office Integration to fail.</p>
<p>The ServiceAPI performs three functions within the integration:</p><ul>
<li>hosts the web application that is embedded in Office as the add-in (at /CMServiceAPI/office/index.html),</li>
<li>provides the backend services to which the add-on communicates when reading from or writing to Content Manager, and</li>
<li>provides services that act as a proxy between the Add-in and OneDrive for reading from and writing to OneDrive.</li>
</ul>
<h2><a class="anchor" id="autotoc_md73"></a>
ServiceAPI Configuration</h2>
<h4><a class="anchor" id="autotoc_md74"></a>
Office Integration configuration</h4>
<p>The ServiceAPI must be provided with the GUID and Version found in the Id element of the Office add-in [manifest](zero_manifests). This guid is used when a document is first opened from Content Manager to notify the add-in that the Content Manager add-in should be auto-opened when the document is opened. To add this GUID:</p><ul>
<li>edit the hptrim.config file</li>
<li>add the officeIntegration element below the setup element</li>
</ul>
<p>** Example **</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">officeIntegration</span> <span class="keyword">guid</span>=<span class="stringliteral">&quot;5d7bd8ba-11b0-46b1-98ab-95fadd95a97d&quot;</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0.0.0&quot;</span>/&gt;</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md75"></a>
ServiceAPI Authentication Permissions</h2>
<p>The ServiceAPI must be configured to use OpenId Connect authentication as described in the <a href="oidc.html#oidc_azuread">authentication section</a>. New permissions must be assigned to the Azure AD Application to support OneDrive access, these are:</p><ul>
<li>Delegated:<ul>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
</ul>
</li>
<li>Application:<ul>
<li>Files.Read.All</li>
<li>Files.ReadWrite.All</li>
<li>Office 365 Exchange Online - full_access_as_app</li>
</ul>
</li>
</ul>
<p>To assign these permissions:</p><ul>
<li>open the Azure AD Application used for authenticating the Web Client</li>
<li>go to API permissions</li>
<li>select 'Add a permission'</li>
<li>select Microsoft Graph</li>
<li>choose either 'Delegated' or 'Application' permissions</li>
<li>find the permission and add it <br  />
</li>
<li>once you have added all the permissions select 'Grant admin consent' to consent to all permissions.</li>
</ul>
<p>** Note ** The Office 365 Exchange Online permission is not a part of the OneDrive permissions, to find it:</p><ul>
<li>select 'Add a permission' <br  />
</li>
<li>select 'API's my organisation uses'</li>
<li>find 'Office 365 Exchange Online' in the listed</li>
<li>add the 'Application' permission as you did the other permissions.</li>
</ul>
<h2><a class="anchor" id="autotoc_md76"></a>
ServiceAPI Authentication Application ID</h2>
<p>The office integration requires that the Application ID Uri in the Azure AD App include the domain name of your ServiceAPI server, this must be adjusted before installing the office integration manifests. To adjust the Application ID URI:</p><ol type="1">
<li>open the Azure App referenced from your ServiceAPI hptrim.config file,</li>
<li>go the 'Expose an API' page,</li>
<li>edit the Application ID URI field,</li>
<li>by default the Application ID URI will look something like this <code>api://2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>,</li>
<li>edit the Application ID URI to include the name of your ServiceAPI server, for example <code>api://myserver.com/2d89cb2b-3cb7-4c21-807e-029fdbfe74a7</code>, then</li>
<li>Once you have modified this you will need to update the appIdURI property (case sensitive) in the ServiceAPI hptrim.config file.</li>
</ol>
<h2><a class="anchor" id="autotoc_md77"></a>
ServiceAPI Authorized Client Applications</h2>
<p>The zero footprint office integration relies on single sign on from the Microsoft addin framework. To allow this to work we need to register our add-in, this is done in the 'Expose an API section of the Azure App created previously. To register your addin:</p><ol type="1">
<li>Add a Scope</li>
<li>name it <code>access_as_user</code></li>
<li>fill in the fields with values you think are appropriate, for example:<ul>
<li><b>Admin consent display name:</b> Office can act as the user.</li>
<li><b>Admin consent description:</b> Enable Office to call the add-in's web APIs with the same rights as the current user.</li>
<li><b>User consent display name:</b> Office can act as you.</li>
<li><b>User consent description:</b> Enable Office to call the add-in's web APIs with the same rights that you have.</li>
</ul>
</li>
<li>save the scope</li>
<li>Add six client applications, each time selecting the scope you just added, the Client Id for each of the three are:<ul>
<li>d3590ed6-52b3-4102-aeff-aad2292ab01c</li>
<li>57fb890c-0dab-4253-a5e0-7188c88b2bb4</li>
<li>bc59ab01-8403-45c6-8796-ac3ef710b3e3</li>
<li>ea5a67f6-b6f3-4338-b240-c655ddc3cc8e</li>
<li>93d53678-613d-4013-afc1-62e9e444a0a5</li>
<li>08e18876-6177-487e-b8b5-cf950c1e598c</li>
</ul>
</li>
</ol>
<h1><a class="anchor" id="zero_manifests"></a>
Manifests</h1>
<p>The manifest's purpose is to notify Office 365 of the presence of your add-in. Manifest files must be customised before upload to your Office 365 Admin. To prepare your manifests:</p><ul>
<li>download the sample manifests (<a href="https://raw.githubusercontent.com/content-manager-sdk/Community/master/docs/files/101/office-addin-manifest-template.xml">office</a>, <a href="https://raw.githubusercontent.com/content-manager-sdk/Community/master/docs/files/101/outlook-addin-manifest-template.xml">outlook</a>),</li>
<li><a href="https://www.guidgenerator.com/online-guid-generator.aspx">generate</a> a new Guid for each manifest (if you are installing both Outlook and Office integrations),</li>
<li>NOTE: If this is an upgrade find the Guid used in the originally installed manigest and use that, ensure the Version element contains a higher number than the original,</li>
<li>replace [MANIFESTGUID] in each manifest with a valid Guid,</li>
<li>set the GUID from the Office manifest in the officeIntegration element in the hptrim.config file (see above),</li>
<li>assuming the ServiceAPI is in the pattern <a href="https://yourserver.com/CMServiceAPI">https://yourserver.com/CMServiceAPI</a> do a search and replace of each manifest, replacing [SERVICEAPIURL] with your URL,</li>
<li>replace [DOMAIN] with your web server domain name,</li>
<li>at the bottom of the manifest is an element called 'WebApplicationInfo', replace [APPCLIENTID] with the Application Id from Azure and [APPIDURI] with the Application ID URI from Azure,</li>
<li>the name of the add-in that will be displayed in the task pane title (and in the context menu for Outlook) is embedded in the manifest, by default it is 'Content Manager' but this can be changed if desired, and</li>
<li>go to the <a href="https://admin.microsoft.com/?applauncher#/Settings/AddIns">Add-ins page</a> in Office 365 Admin and deploy each manifest.</li>
</ul>
<p><b>Note</b> The <a href="zero_teams.html#zero_teams_script">setup script</a> used for the Microsoft Teams integration also generates manifests for Office, this may be simpler than following the manual steps above.</p>
<h1><a class="anchor" id="autotoc_md78"></a>
Browser Cookies</h1>
<p>It may be that the Office addin does not display after it has been uploaded, if this is the case ensure that all cookie blocking is disabled in your web browser.</p>
<h1><a class="anchor" id="autotoc_md79"></a>
Email Link</h1>
<p>Email Link serves to purposes in the Outlook/Office integration, to:</p><ol type="1">
<li>file email from Linked Folders in the Outlook integration, and</li>
<li>check documents in from Office applications when 'check in on close' is selected.</li>
</ol>
<p>Email Link should be installed as usual, there must be a Microsoft authentication configuration for your Office 365 domain that is of type OAuth and has both Email and Drive selected (if both Office and Outlook integration is required). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
